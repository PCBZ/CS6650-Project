version: '3.8'

services:
  timeline-service:
    build: .
    ports:
      - "8084:8084"
    environment:
      # Override default environment variables
      TIMELINE_SERVICE_PORT: 8084
      ENVIRONMENT: dev
      AWS_REGION: us-east-1
      DYNAMODB_POSTS_TABLE: posts-dev
      SQS_QUEUE_URL: https://sqs.us-east-1.amazonaws.com/123456789012/timeline-feed-queue
      USER_SERVICE_ENDPOINT: mock  # Options: mock, http://user-service:8080
      FANOUT_STRATEGY: push  # Options: push, pull, hybrid
      CELEBRITY_THRESHOLD: 50000
      LOG_LEVEL: info
    depends_on:
      - localstack
    networks:
      - timeline-network

  # LocalStack for local AWS services (optional for development)
  localstack:
    image: localstack/localstack:latest
    ports:
      - "4566:4566"
    environment:
      SERVICES: dynamodb,sqs
      DEBUG: 1
      DATA_DIR: /tmp/localstack/data
    volumes:
      - ./localstack:/tmp/localstack
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - timeline-network

networks:
  timeline-network:
    driver: bridge

# Example configurations for different strategies:
# 
# For Push Strategy (current default):
# FANOUT_STRATEGY=push
# 
# For Pull Strategy:
# FANOUT_STRATEGY=pull
# 
# For Hybrid Strategy:  
# FANOUT_STRATEGY=hybrid
# CELEBRITY_THRESHOLD=100000